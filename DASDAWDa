-- 🌌 SDVT SAB | Safe Auto-Move & Tool Slot 2 Hotkey
-- Made by ChatGPT (for SDVT)
-- Uses Pathfinding, safe movement, manual activation (no automation)
-- Works with Rayfield Sirius UI

-- 🧩 Load Rayfield
local ok, Rayfield = pcall(function()
	return loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)

if not ok or not Rayfield then
	warn("⚠️ Không thể tải Rayfield.")
	return
end

local Players = game:GetService("Players")
local PathfindingService = game:GetService("PathfindingService")
local ContextActionService = game:GetService("ContextActionService")
local player = Players.LocalPlayer

-- 🌌 Window
local Window = Rayfield:CreateWindow({
	Name = "SDVT SAB",
	LoadingTitle = "SDVT Hub",
	LoadingSubtitle = "Auto Script",
	ConfigurationSaving = {
		Enabled = true,
		FolderName = "SDVT",
		FileName = "SDVTSAB"
	}
})

-- ========================
-- 📜 TAB 1: INFO
-- ========================
local InfoTab = Window:CreateTab("📜 Info", 4483362458)
InfoTab:CreateSection("👤 Người Dùng")
InfoTab:CreateLabel("Tên: " .. player.Name)
InfoTab:CreateLabel("UserID: " .. player.UserId)
InfoTab:CreateLabel("GameID: " .. game.PlaceId)
InfoTab:CreateLabel("Mô tả: SDVT Hub Auto Script - phiên bản an toàn.")

-- ========================
-- 📍 TAB 2: MAIN
-- ========================
local MainTab = Window:CreateTab("🧭 Main", 4483362458)
MainTab:CreateSection("📌 Tọa độ hiện tại")

local coordLabel = MainTab:CreateLabel("Tọa độ: Chưa lấy")

local function getPos()
	local char = player.Character or player.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	return hrp.Position
end

MainTab:CreateButton({
	Name = "📍 Lấy tọa độ + Copy",
	Callback = function()
		local pos = getPos()
		local coord = string.format("X: %.2f, Y: %.2f, Z: %.2f", pos.X, pos.Y, pos.Z)
		coordLabel:Set("Tọa độ: " .. coord)
		setclipboard(coord)
		Rayfield:Notify({
			Title = "✅ Đã sao chép!",
			Content = coord,
			Duration = 3
		})
	end
})

-- ========================
-- 🎯 TAB 3: EVENT
-- ========================
local EventTab = Window:CreateTab("🎯 Event ESP", 4483362458)
EventTab:CreateSection("🏁 Di chuyển tự nhiên (Pathfinding)")

-- Các điểm đến
local GO_POINTS = {
	Vector3.new(-325.63, -6.39, 58.34),   -- Go #1
	Vector3.new(-377.17, -6.98, 183.61),  -- Go #2
	Vector3.new(-320.29, -6.99, 171.93)   -- Go #3
}

-- Di chuyển an toàn (tránh tường)
local function SafeMoveTo(destination)
	local char = player.Character or player.CharacterAdded:Wait()
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not humanoid or not hrp then
		return Rayfield:Notify({Title="⚠️ Lỗi", Content="Không tìm thấy nhân vật.", Duration=3})
	end

	local path = PathfindingService:CreatePath({AgentRadius=2, AgentHeight=5, AgentCanJump=true})
	path:ComputeAsync(hrp.Position, destination)

	if path.Status ~= Enum.PathStatus.Success then
		return Rayfield:Notify({Title="❌ Lỗi đường đi", Content="Không thể tạo đường hợp lệ!", Duration=3})
	end

	local waypoints = path:GetWaypoints()
	for _, wp in ipairs(waypoints) do
		if wp.Action == Enum.PathWaypointAction.Jump then
			humanoid.Jump = true
		end
		humanoid:MoveTo(wp.Position)
		humanoid.MoveToFinished:Wait()
	end
	Rayfield:Notify({Title="✅ Đã đến", Content="Bạn đã đến điểm được chọn.", Duration=3})
end

-- Tạo nút di chuyển
for i, pt in ipairs(GO_POINTS) do
	EventTab:CreateButton({
		Name = "🪦 Go #" .. i,
		Callback = function()
			SafeMoveTo(pt)
		end
	})
end

-- ========================
-- 🛠 TAB 4: CONTROL / HOTKEY
-- ========================
local ControlTab = Window:CreateTab("⚙️ Control", 4483362458)
ControlTab:CreateSection("⌨️ Phím Tắt Tool Slot 2")

-- Hàm equip tool slot 2 (khi bạn NHẤN phím 2 thật)
local function equipAndActivateSlot2()
	local backpack = player:FindFirstChildOfClass("Backpack")
	local char = player.Character
	if not backpack or not char then
		return Rayfield:Notify({Title="⚠️ Lỗi", Content="Không tìm thấy Backpack hoặc nhân vật.", Duration=3})
	end

	-- Lấy tool thứ 2 trong Backpack
	local tools = {}
	for _, item in ipairs(backpack:GetChildren()) do
		if item:IsA("Tool") then table.insert(tools, item) end
	end

	local tool = tools[2] or tools[1]
	if not tool then
		return Rayfield:Notify({Title="⚠️ Tool", Content="Không có tool nào trong slot 2.", Duration=3})
	end

	tool.Parent = char
	task.wait(0.3)
	pcall(function() tool:Activate() end)

	Rayfield:Notify({
		Title = "🛠 Tool Slot 2",
		Content = "Đã equip và gọi Activate() cho tool slot 2.",
		Duration = 3
	})
end

-- Gán phím 2 (người dùng thật sự nhấn)
ContextActionService:BindActionAtPriority(
	"SDVT_ActivateSlot2",
	function(_, inputState)
		if inputState == Enum.UserInputState.Begin then
			equipAndActivateSlot2()
		end
	end,
	false,
	Enum.ContextActionPriority.High.Value,
	Enum.KeyCode.Two
)

ControlTab:CreateLabel("Nhấn phím [2] để kích hoạt Tool Slot 2 (bằng tay).")

-- ========================
-- 🔁 Auto Load thông báo
-- ========================
Rayfield:Notify({
	Title = "📂 SDVT Auto Load",
	Content = "Cấu hình SDVTSAB đã được tự động tải.",
	Duration = 3
})
