-- ‚ö° Rey Menu - Server Hop + Job ID Joiner
-- B·∫£n m·ªü r·ªông v·ªõi Tab "Job ID"
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer

local PLACE_ID = game.PlaceId
local API_URL = "https://games.roblox.com/v1/games/".. PLACE_ID .."/servers/Public?sortOrder=Asc&limit=100"

-- ‚öôÔ∏è UI
local Window = Rayfield:CreateWindow({
    Name = "‚ö° Rey Menu ‚ö°",
    LoadingTitle = "Rey Hub",
    LoadingSubtitle = "Server Tools",
    ConfigurationSaving = {
        Enabled = true,
        FileName = "ReyMenu"
    }
})

-- üß≠ TAB 1: INFO
local InfoTab = Window:CreateTab("Info", 4483362458)
InfoTab:CreateLabel("üë§ T√™n: " .. LocalPlayer.Name)
local lblCount = InfoTab:CreateLabel("üë• S·ªë ng∆∞·ªùi hi·ªán t·∫°i: " .. #Players:GetPlayers())
task.spawn(function()
    while task.wait(2) do
        lblCount:Set("üë• S·ªë ng∆∞·ªùi hi·ªán t·∫°i: " .. #Players:GetPlayers())
    end
end)

-- üåê TAB 2: SERVER HOP
local ServerTab = Window:CreateTab("Server", 4483362458)
ServerTab:CreateSection("üîÑ Hop Server Low (1-2 ng∆∞·ªùi)")
local statusLabel = ServerTab:CreateLabel("Status: S·∫µn s√†ng ‚úÖ")

local function FindLowServer()
    local cursor = nil
    while true do
        local url = API_URL
        if cursor then
            url = url .. "&cursor=" .. HttpService:UrlEncode(cursor)
        end

        local success, body = pcall(function()
            return game:HttpGet(url)
        end)

        if success then
            local data = HttpService:JSONDecode(body)
            for _, server in ipairs(data.data) do
                if tonumber(server.playing) and server.playing <= 2 and server.id ~= game.JobId then
                    return server
                end
            end
            cursor = data.nextPageCursor
            if not cursor then break end
        end
        task.wait(0.2)
    end
    return nil
end

local function Notify(title, desc, time)
    Rayfield:Notify({
        Title = title,
        Content = desc,
        Duration = time or 4
    })
end

ServerTab:CreateButton({
    Name = "üåê Hop Server Low (‚â§2 ng∆∞·ªùi)",
    Callback = function()
        statusLabel:Set("üîé ƒêang t√¨m server √≠t ng∆∞·ªùi h∆°n...")
        Notify("Server Hop", "ƒêang qu√©t server c√≥ ‚â§ 2 ng∆∞·ªùi...", 4)

        task.spawn(function()
            local server
            repeat
                server = FindLowServer()
                task.wait(1)
            until server ~= nil

            if server then
                statusLabel:Set("‚úÖ ƒê√£ t√¨m th·∫•y server c√≥ ".. tostring(server.playing) .." ng∆∞·ªùi, ƒëang d·ªãch chuy·ªÉn...")
                Notify("Th√†nh c√¥ng üéâ", "ƒêang chuy·ªÉn sang server √≠t ng∆∞·ªùi!", 5)

                TeleportService:TeleportToPlaceInstance(PLACE_ID, server.id, LocalPlayer)
            else
                statusLabel:Set("‚ùå Kh√¥ng t√¨m th·∫•y server ph√π h·ª£p")
            end
        end)
    end
})

-- üß© TAB 3: JOB ID
local JobTab = Window:CreateTab("Job ID", 4483362458)
JobTab:CreateSection("ü™™ Qu·∫£n l√Ω Job ID")

-- ‚úÖ Input ƒë·ªÉ nh·∫≠p Job ID v√† join
JobTab:CreateInput({
    Name = "Nh·∫≠p Job ID ƒë·ªÉ Join",
    PlaceholderText = "Nh·∫≠p Job ID v√†o ƒë√¢y...",
    RemoveTextAfterFocusLost = false,
    Callback = function(jobId)
        if jobId and jobId ~= "" then
            Notify("ƒêang d·ªãch chuy·ªÉn üåê", "ƒêang v√†o Job ID: ".. jobId, 4)
            local success, err = pcall(function()
                TeleportService:TeleportToPlaceInstance(PLACE_ID, jobId, LocalPlayer)
            end)
            if not success then
                Notify("‚ùå L·ªói", "Kh√¥ng th·ªÉ join Job ID n√†y!", 5)
            end
        else
            Notify("‚ö†Ô∏è C·∫£nh b√°o", "B·∫°n ch∆∞a nh·∫≠p Job ID!", 4)
        end
    end
})

-- üìã N√∫t Copy Job ID hi·ªán t·∫°i
JobTab:CreateButton({
    Name = "üìã Copy Job ID hi·ªán t·∫°i",
    Callback = function()
        if setclipboard then
            setclipboard(game.JobId)
            Notify("‚úÖ Copied", "ƒê√£ sao ch√©p Job ID hi·ªán t·∫°i!", 3)
        else
            Notify("‚ö†Ô∏è Kh√¥ng h·ªó tr·ª£", "Tr√¨nh ch·∫°y kh√¥ng cho ph√©p copy clipboard!", 5)
        end
    end
})

-- üßæ Hi·ªán Job ID hi·ªán t·∫°i
JobTab:CreateLabel("üîñ Job ID hi·ªán t·∫°i: " .. game.JobId)
